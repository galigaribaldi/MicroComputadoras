def_sub retms(n as integer)

  'Este procedimiento genera una espera de n milisegundos,
  'se supone que la frecuencia del reloj de bus del MCU 
  'es 20 MHz.

    if n < 1 or n > 32766 then
    'Si 'n' no está en el rango apropiado
    'retorna sin generar un retardo. 
     exit_sub
    endif
  
        for i%=1 to n
        gosub ret1ms
        next i%

        exit_sub

ret1ms:
        iniens
        pshh
        pshx
        ldhx #$07cd
vuelta: nop
        nop
        aix #$ff
        cphx #$0000
        bne vuelta
        pulx
        pulh
        rts
        finens
       
   end_sub 
